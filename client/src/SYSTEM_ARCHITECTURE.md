# Mashtal User Sync - System Architecture

## ğŸ—ï¸ High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           MASHTAL PLATFORM                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      React App (App.tsx)                         â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚                   Context Providers                        â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  AuthProvider                                        â”‚  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ User authentication                               â”‚  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ Login/logout                                      â”‚  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ User switching                                    â”‚  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ Role management                                   â”‚  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚                           â”‚                                â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  PostInteractionsProvider                            â”‚  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ Likes tracking (per user)                         â”‚  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ Saves tracking (per user)                         â”‚  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ Interaction counts                                â”‚  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ localStorage sync                                 â”‚  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚                           â”‚                                â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  UserDataProvider                                    â”‚  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ User content (per user)                           â”‚  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ Saved items                                       â”‚  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ Posts & Threads                                   â”‚  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ Products (businesses)                             â”‚  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ Followers & Following                             â”‚  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ localStorage sync                                 â”‚  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚                           â”‚                                â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                              â”‚                                    â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚              Application Components & Pages                 â”‚  â”‚   â”‚
â”‚  â”‚  â”‚                                                              â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  Navigation  Posts  Threads  Profile  Business  Chats       â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  Dashboard   Search  Cart     Saved    Following  Followers â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                    â”‚                                    â”‚
â”‚                                    â†“                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                  Browser localStorage                            â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚  mashtal_user        â”‚  â”‚  mashtal_user_data            â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  {                   â”‚  â”‚  {                             â”‚   â”‚   â”‚
â”‚  â”‚  â”‚    id: "current",    â”‚  â”‚    "me": {                     â”‚   â”‚   â”‚
â”‚  â”‚  â”‚    role: "user",     â”‚  â”‚      savedItems: [...],        â”‚   â”‚   â”‚
â”‚  â”‚  â”‚    ...               â”‚  â”‚      posts: [...],             â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  }                   â”‚  â”‚      threads: [...],           â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚      followers: [...],         â”‚   â”‚   â”‚
â”‚  â”‚                             â”‚      following: [...],         â”‚   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚      products: [...]           â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  mashtal_user_       â”‚  â”‚    },                          â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  interactions        â”‚  â”‚    "eng1": {...},              â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  {                   â”‚  â”‚    "biz1": {...}               â”‚   â”‚   â”‚
â”‚  â”‚  â”‚    "me": {           â”‚  â”‚  }                             â”‚   â”‚   â”‚
â”‚  â”‚  â”‚      likes: [...],   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚  â”‚      saves: [...]    â”‚                                       â”‚   â”‚
â”‚  â”‚  â”‚    },                â”‚                                       â”‚   â”‚
â”‚  â”‚  â”‚    "eng1": {...}     â”‚                                       â”‚   â”‚
â”‚  â”‚  â”‚  }                   â”‚                                       â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ User Switch Sequence Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User   â”‚         â”‚   UI     â”‚      â”‚ AuthContext â”‚     â”‚ UserData     â”‚
â”‚         â”‚         â”‚          â”‚      â”‚             â”‚     â”‚ Context      â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                   â”‚                   â”‚                   â”‚
     â”‚  Click Switch     â”‚                   â”‚                   â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚                   â”‚
     â”‚                   â”‚                   â”‚                   â”‚
     â”‚              Show Modal               â”‚                   â”‚
     â”‚                   â”‚                   â”‚                   â”‚
     â”‚  Select User      â”‚                   â”‚                   â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚                   â”‚
     â”‚                   â”‚                   â”‚                   â”‚
     â”‚                   â”‚ switchUser(id)    â”‚                   â”‚
     â”‚                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
     â”‚                   â”‚                   â”‚                   â”‚
     â”‚                   â”‚            Save to localStorage       â”‚
     â”‚                   â”‚                   â”‚                   â”‚
     â”‚                   â”‚            Update user state          â”‚
     â”‚                   â”‚                   â”‚                   â”‚
     â”‚                   â”‚                   â”‚  Detect user      â”‚
     â”‚                   â”‚                   â”‚  change (useEffect)
     â”‚                   â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> â”‚
     â”‚                   â”‚                   â”‚                   â”‚
     â”‚                   â”‚                   â”‚  Load user data   â”‚
     â”‚                   â”‚                   â”‚  from localStorageâ”‚
     â”‚                   â”‚                   â”‚                   â”‚
     â”‚                   â”‚                   â”‚  Initialize if    â”‚
     â”‚                   â”‚                   â”‚  first time       â”‚
     â”‚                   â”‚                   â”‚                   â”‚
     â”‚                   â”‚                   â”‚  Update state     â”‚
     â”‚                   â”‚                   â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                   â”‚                   â”‚                   â”‚
     â”‚                   â”‚  User data ready  â”‚                   â”‚
     â”‚                   â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                   â”‚
     â”‚                   â”‚                   â”‚                   â”‚
     â”‚            UI Re-renders              â”‚                   â”‚
     â”‚                   â”‚                   â”‚                   â”‚
     â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                   â”‚                   â”‚
     â”‚                   â”‚                   â”‚                   â”‚
     â”‚  See new user's   â”‚                   â”‚                   â”‚
     â”‚  data             â”‚                   â”‚                   â”‚
     â”‚                   â”‚                   â”‚                   â”‚
```

---

## ğŸ“¦ Data Structure Details

### AuthContext State
```typescript
{
  user: {
    id: string;              // "me", "eng1", "biz1", etc.
    email: string;
    fullName: string;
    role: UserRole;          // 'user' | 'engineer' | 'agronomist' | 'business'
    avatar: string;
    phone: string;
    location: string;
    bio: string;
    verified: boolean;
    businessId?: string;     // For businesses
    companyName?: string;
  },
  isAuthenticated: boolean;
  availableUsers: User[];    // For switching
}
```

### UserDataContext State (Per User)
```typescript
{
  "me": {
    savedItems: [
      {
        id: string;
        type: 'product' | 'post' | 'thread' | 'business';
        itemId: string;
        title: string;
        image: string;
        description: string;
        savedAt: Date;
      },
      // ... more saved items
    ],
    posts: [
      {
        id: string;
        authorId: string;      // === "me"
        title: string;
        content: string;
        image: string;
        tags: string[];
        likes: number;
        commentsCount: number;
        shares: number;
        timeAgo: string;
        author: UserObject;     // Full user data
      },
      // ... more posts
    ],
    threads: [...],             // Similar to posts
    products: [],               // Empty for non-business users
    followers: [
      {
        id: string;
        fullName: string;
        avatar: string;
        role: UserRole;
        location: string;
        followingSince: string;
      },
      // ... more followers
    ],
    following: [...]           // Similar to followers
  },
  "eng1": {
    // Engineer's data structure
    savedItems: [...],
    posts: [...],              // Engineer's posts
    threads: [...],            // Engineer's threads
    products: [],              // No products
    followers: [...],
    following: [...]
  },
  "biz1": {
    // Business's data structure
    savedItems: [...],
    posts: [...],
    threads: [...],
    products: [                // Only businesses have products
      {
        id: string;
        businessId: string;    // === "1" (business ID)
        name: string;
        description: string;
        price: number;
        image: string;
        category: string;
        stock: number;
        rating: number;
        reviewsCount: number;
      },
      // ... more products
    ],
    followers: [...],
    following: [...]
  }
}
```

### PostInteractionsContext State (Per User)
```typescript
{
  "me": {
    likes: Set<string>,         // ["p1", "p5", "t3"]
    saves: Set<string>,         // ["p2", "prod1"]
    postLikeCounts: {
      "p1": 1,                  // +1 like from initial count
      "p5": -1                  // -1 like from initial count
    },
    postCommentCounts: {
      "p1": 2                   // +2 comments from initial count
    },
    postShareCounts: {
      "p1": 1                   // +1 share from initial count
    }
  },
  "eng1": {
    likes: Set<string>,         // ["p2", "p3", "t1"]
    saves: Set<string>,         // ["p3"]
    postLikeCounts: {...},
    postCommentCounts: {...},
    postShareCounts: {...}
  }
}
```

---

## ğŸ¯ Role-Based Access Matrix

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Feature              â”‚  User   â”‚ Engineer â”‚ Agronomist â”‚ Business â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Browse Products      â”‚   âœ…    â”‚    âœ…    â”‚     âœ…     â”‚    âŒ    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Purchase Products    â”‚   âœ…    â”‚    âœ…    â”‚     âœ…     â”‚    âŒ    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Purchase History     â”‚   âœ…    â”‚    âŒ    â”‚     âŒ     â”‚    âŒ    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Create Posts         â”‚   âœ…    â”‚    âœ…    â”‚     âœ…     â”‚    âœ…    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Create Threads       â”‚   âœ…    â”‚    âœ…    â”‚     âœ…     â”‚    âœ…    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Receive DMs          â”‚   âŒ    â”‚    âœ…    â”‚     âœ…     â”‚    âœ…    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Can Be Followed      â”‚   âŒ    â”‚    âœ…    â”‚     âœ…     â”‚    âœ…    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Follow Others        â”‚   âœ…    â”‚    âœ…    â”‚     âœ…     â”‚    âœ…    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Followers Page       â”‚   âŒ    â”‚    âœ…    â”‚     âœ…     â”‚    âœ…    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Dashboard Access     â”‚   âŒ    â”‚    âŒ    â”‚     âŒ     â”‚    âœ…    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Product Management   â”‚   âŒ    â”‚    âŒ    â”‚     âŒ     â”‚    âœ…    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Analytics Dashboard  â”‚   âŒ    â”‚    âŒ    â”‚     âŒ     â”‚    âœ…    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Save Items           â”‚   âœ…    â”‚    âœ…    â”‚     âœ…     â”‚    âœ…    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Like/Comment/Share   â”‚   âœ…    â”‚    âœ…    â”‚     âœ…     â”‚    âœ…    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”€ State Synchronization Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    User Switches from A to B                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ AuthContext     â”‚
                    â”‚ switchUser(B)   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                              â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ Save User A     â”‚         â”‚ Load User B        â”‚
     â”‚ to localStorage â”‚         â”‚ from localStorage  â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                             â”‚
              â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                    â”‚ User B exists?  â”‚
              â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                             â”‚
              â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                  â”‚                      â”‚
              â”‚            â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
              â”‚            â”‚ Yes: Load â”‚        â”‚ No: Init    â”‚
              â”‚            â”‚ from data â”‚        â”‚ with mocks  â”‚
              â”‚            â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
              â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                             â”‚
              â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                  â”‚ UserDataContext     â”‚
              â”‚                  â”‚ updates state       â”‚
              â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                             â”‚
              â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                  â”‚ PostInteractions       â”‚
              â”‚                  â”‚ Context updates state  â”‚
              â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                             â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                                            â”‚
                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                             â”‚ All Components Re-render     â”‚
                             â”‚ with User B's data          â”‚
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                            â”‚
                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                             â”‚ User sees:                  â”‚
                             â”‚ â€¢ User B's saved items       â”‚
                             â”‚ â€¢ User B's posts/threads     â”‚
                             â”‚ â€¢ User B's followers         â”‚
                             â”‚ â€¢ User B's interactions      â”‚
                             â”‚ â€¢ Role-based navigation     â”‚
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¾ localStorage Schema

```json
{
  "mashtal_user": {
    "id": "me",
    "email": "ahmed@example.com",
    "fullName": "Ahmed Al-Mansour",
    "role": "user",
    "avatar": "https://...",
    "phone": "+966...",
    "location": "Riyadh",
    "bio": "Farmer...",
    "verified": false
  },
  
  "mashtal_user_data": {
    "me": {
      "savedItems": [
        {
          "id": "1",
          "type": "post",
          "itemId": "p1",
          "title": "Post Title",
          "image": "https://...",
          "description": "...",
          "savedAt": "2026-02-01T..."
        }
      ],
      "posts": [...],
      "threads": [...],
      "products": [],
      "followers": [...],
      "following": [...]
    },
    "eng1": {...},
    "biz1": {...}
  },
  
  "mashtal_user_interactions": {
    "me": {
      "likes": ["p1", "p5", "t3"],
      "saves": ["p2", "prod1"],
      "postLikeCounts": {"p1": 1},
      "postCommentCounts": {},
      "postShareCounts": {}
    },
    "eng1": {...},
    "biz1": {...}
  }
}
```

---

## ğŸ”Œ Integration Points

### 1. **Context Hooks**
```typescript
// Get current user
const { user, switchUser } = useAuth();

// Get user-specific data
const {
  savedItems,
  userPosts,
  userThreads,
  followers,
  following,
  addSavedItem,
  removeSavedItem
} = useUserData();

// Get user-specific interactions
const {
  isLiked,
  isSaved,
  toggleLike,
  toggleSave,
  getLikeCount
} = usePostInteractions();
```

### 2. **Debug Utilities**
```typescript
// Available in browser console
window.mashtalDebug = {
  getAllUserIds(),
  getUserDataSnapshot(userId),
  printUserDataTable(),
  clearUserData(userId),
  clearAllUserData(),
  exportUserData(),
  downloadUserData(),
  printStorageStats(),
  validateDataIntegrity(),
  printIntegrityReport()
};
```

---

## ğŸ¨ Component Hierarchy

```
App
â”œâ”€â”€ AuthProvider
â”‚   â””â”€â”€ User State
â”‚       â”œâ”€â”€ Current User
â”‚       â”œâ”€â”€ Available Users
â”‚       â””â”€â”€ Authentication Methods
â”‚
â”œâ”€â”€ PostInteractionsProvider
â”‚   â””â”€â”€ User Interactions (per user ID)
â”‚       â”œâ”€â”€ Likes
â”‚       â”œâ”€â”€ Saves
â”‚       â””â”€â”€ Counts
â”‚
â””â”€â”€ UserDataProvider
    â””â”€â”€ User Content (per user ID)
        â”œâ”€â”€ Saved Items
        â”œâ”€â”€ Posts
        â”œâ”€â”€ Threads
        â”œâ”€â”€ Products (businesses)
        â”œâ”€â”€ Followers
        â””â”€â”€ Following
```

---

## ğŸ“Š Performance Characteristics

### Time Complexity
- User switch: **O(1)** - Direct lookup in map
- Load data: **O(1)** - localStorage read
- Save data: **O(1)** - localStorage write
- Get saved items: **O(1)** - Direct access
- Filter posts: **O(n)** - Where n = total posts

### Space Complexity
- Per user: **O(p + t + s + f)** - Where:
  - p = number of posts
  - t = number of threads
  - s = number of saved items
  - f = number of followers/following
- Total: **O(u Ã— (p + t + s + f))** - Where u = number of users

### Browser Limits
- localStorage: **5-10 MB** (browser dependent)
- Estimated capacity: **~100-200 users** with full data
- Recommended: **Migrate to Supabase** for production

---

This architecture ensures complete data isolation, instant switching, and persistent storage while maintaining clean separation of concerns through React contexts.
